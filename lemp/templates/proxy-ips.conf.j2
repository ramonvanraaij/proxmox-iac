# This file is managed by Ansible. Do not edit manually.

{% if configure_cloudflare and nginx_proxy_manager_ip %}
# SCENARIO 4: Cloudflare -> NPM -> LEMP
# --- The ONLY IP we need to trust is our proxy ---
set_real_ip_from {{ nginx_proxy_manager_ip }};

# --- The header containing the REAL visitor IP from Cloudflare ---
real_ip_header CF-Connecting-IP;

{% elif nginx_proxy_manager_ip %}
# SCENARIO 3: NPM Only -> LEMP
# Trust requests from my Nginx Proxy Manager
set_real_ip_from {{ nginx_proxy_manager_ip }};

# Use the standard header that NPM is sending
real_ip_header X-Forwarded-For;
real_ip_recursive on;

{% elif configure_cloudflare %}
# SCENARIO 2: Cloudflare -> LEMP
# Tell Nginx to find the real IP in the Cloudflare header
real_ip_header CF-Connecting-IP;

{% endif %}
